<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · ModelicaScriptingTools.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ModelicaScriptingTools.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">ModelicaScriptingTools.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Basic-utility-functions-1"><span>Basic utility functions</span></a></li><li><a class="tocitem" href="#Session-handling-1"><span>Session handling</span></a></li><li><a class="tocitem" href="#Simulation-1"><span>Simulation</span></a></li><li><a class="tocitem" href="#Testing-1"><span>Testing</span></a></li><li><a class="tocitem" href="#Error-handling-1"><span>Error handling</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/master/docs/src/api.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API-1"><a class="docs-heading-anchor" href="#API-1">API</a><a class="docs-heading-anchor-permalink" href="#API-1" title="Permalink"></a></h1><h2 id="Basic-utility-functions-1"><a class="docs-heading-anchor" href="#Basic-utility-functions-1">Basic utility functions</a><a class="docs-heading-anchor-permalink" href="#Basic-utility-functions-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.moescape" href="#ModelicaScriptingTools.moescape"><code>ModelicaScriptingTools.moescape</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">moescape(s:: String)</code></pre><p>Escapes string according to Modelica specification for string literals.</p><p>Escaped characters are: <code>[&#39;\\&#39;, &#39;&quot;&#39;, &#39;?&#39;, &#39;\a&#39;, &#39;\b&#39;, &#39;\f&#39;, &#39;\n&#39;, &#39;\r&#39;, &#39;\t&#39;, &#39;\v&#39;,]</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L80-L86">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.mounescape" href="#ModelicaScriptingTools.mounescape"><code>ModelicaScriptingTools.mounescape</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">moescape(s:: String)
moescape(io:: IO, s:: String)</code></pre><p>Unescapes string that was escaped by <a href="#ModelicaScriptingTools.moescape"><code>moescape(s:: String)</code></a> or that was returned from the OMC compiler. If <code>io</code> is given the string is printed to the <code>IO</code> object, otherwise it is returned directly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L103-L110">source</a></section></article><h2 id="Session-handling-1"><a class="docs-heading-anchor" href="#Session-handling-1">Session handling</a><a class="docs-heading-anchor-permalink" href="#Session-handling-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.setupOMCSession" href="#ModelicaScriptingTools.setupOMCSession"><code>ModelicaScriptingTools.setupOMCSession</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">setupOMCSession(outdir, modeldir; quiet=false, checkunits=true)</code></pre><p>Creates an <code>OMCSession</code> and prepares it by preforming the following steps:</p><ul><li>add <code>modeldir</code> to the MODELICAPATH</li><li>enable unit checking with the OMC command line option   <code>--preOptModules+=unitChecking</code> (unless <code>checkunits</code> is false)</li><li>load the modelica standard library (<code>loadModel(Modelica)</code>)</li></ul><p>If <code>quiet</code> is false, the resulting MODELICAPATH is printed to stdout.</p><p>Returns the newly created OMCSession.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L356-L369">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.closeOMCSession" href="#ModelicaScriptingTools.closeOMCSession"><code>ModelicaScriptingTools.closeOMCSession</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">closeOMCSession(omc:: OMCSession; quiet=false)</code></pre><p>Closes the OMCSession given by <code>omc</code>, shutting down the OMC instance.</p><p>Due to a <a href="https://github.com/OpenModelica/jl/issues/32">bug in the current release version of OMJulia</a> the function may occasionally freeze. If this happens, you have to stop the execution with CTRL-C. You can tell that this is the case if the output <code>Closing OMC session</code> is printed to stdout, but it is not followed by <code>Done</code>. If desired, these outputs can be disabled by setting <code>quiet=true</code>.</p><p>If you want to use a MoST.jl script for continuous integration, you can use the following shell command to add a timeout to your script and treat the timeout as a successful test run (which is, of course, unsafe).</p><pre><code class="language-bash">(timeout 2m julia myTestScript.jl; rc=$?; if [ ${rc} -eq 124 ]; then exit 0; else exit ${rc}; fi;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L391-L410">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.withOMC" href="#ModelicaScriptingTools.withOMC"><code>ModelicaScriptingTools.withOMC</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">withOMC(f:: Function, outdir, modeldir; quiet=false, checkunits=true)</code></pre><p>Allows to use OMCSession with do-block syntax, automatically closing the session after the block has been executed. For the parameter definition see <a href="#ModelicaScriptingTools.setupOMCSession"><code>setupOMCSession(outdir, modeldir; quiet=false, checkunits=true)</code></a>.</p><p>Example:</p><pre><code class="language-julia">withOMC(&quot;test/out&quot;, &quot;test/res&quot;) do omc
    loadModel(omc, &quot;Example&quot;)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L423-L437">source</a></section></article><h2 id="Simulation-1"><a class="docs-heading-anchor" href="#Simulation-1">Simulation</a><a class="docs-heading-anchor-permalink" href="#Simulation-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.loadModel" href="#ModelicaScriptingTools.loadModel"><code>ModelicaScriptingTools.loadModel</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">loadModel(omc:: OMCSession, name:: String)</code></pre><p>Loads the model with fully qualified name <code>name</code> from a source file available from the model directory. Note that this refers to the model <em>name</em>, not the model <em>file</em>.</p><p>Example:</p><pre><code class="language-none">loadModel(omc, &quot;Modelica.SIunits.Voltage&quot;)</code></pre><p>This function will actually call several OM scripting functions to ensure that as many errors in the model are caught and thrown as <a href="#ModelicaScriptingTools.MoSTError"><code>MoSTError</code></a>s as possible:</p><ul><li>First, <code>loadModel(name)</code> is called to load the model if it exists. This   call does only fail if the toplevel model does not exist. E.g.,   <code>loadModel(Modelica.FooBar)</code> would still return true, because <code>Modelica</code>   could be loaded, although <code>FooBar</code> does not exist.</li><li>We then check with <code>isModel(name)</code> if the model actually exists.</li><li>With <code>checkModel(name)</code> we find errors such as missing or mistyped variables.</li><li>Finally, we use <code>instantiateModel(name)</code> which can sometimes find additional   errors in the model structure.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L34-L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.getSimulationSettings" href="#ModelicaScriptingTools.getSimulationSettings"><code>ModelicaScriptingTools.getSimulationSettings</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">getSimulationSettings(omc:: OMCSession, name:: String; override=Dict())</code></pre><p>Reads simulation settings from the model <code>name</code>. Any content in <code>override</code> will override the setting with the respective key.</p><p>Returns a Dict with the keys <code>&quot;startTime&quot;</code>, <code>&quot;stopTime&quot;</code>, <code>&quot;tolerance&quot;</code>, <code>&quot;numberOfIntervals&quot;</code>, <code>&quot;outputFormat&quot;</code> and <code>&quot;variableFilter&quot;</code>. If any of these settings are not defined in the model file, they will be filled with default values.</p><p>Throws a <a href="#ModelicaScriptingTools.MoSTError"><code>MoSTError</code></a> if the model <code>name</code> was not loaded beforehand using <a href="#ModelicaScriptingTools.loadModel"><code>loadModel(omc:: OMCSession, name:: String)</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L149-L162">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.getVariableFilter" href="#ModelicaScriptingTools.getVariableFilter"><code>ModelicaScriptingTools.getVariableFilter</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">getVariableFilter(omc:: OMCSession, name:: String)</code></pre><p>Reads the value for the <code>variableFilter</code> simulation setting from the model file if it has been defined. MoST assumes that this value will be given in a vendor-specific annotation of the form <code>__MoST_experiment(variableFilter=&quot;.*&quot;)</code>. If such an annotation is not found, the default filter <code>&quot;.*&quot;</code> is returned.</p><p>Throws a <a href="#ModelicaScriptingTools.MoSTError"><code>MoSTError</code></a> if the model <code>name</code> does not exist.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L179-L189">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.simulate" href="#ModelicaScriptingTools.simulate"><code>ModelicaScriptingTools.simulate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">simulate(omc:: OMCSession, name::String)
simulate(omc:: OMCSession, name::String, settings:: Dict{String, Any})</code></pre><p>Simulates the model <code>name</code> which must have been loaded before with <a href="#ModelicaScriptingTools.loadModel"><code>loadModel(omc:: OMCSession, name:: String)</code></a>. The keyword-parameters in <code>settings</code> are directly passed to the OpenModelica scripting function <code>simulate()</code>. If the parameter is not given, it is obtained using <a href="#ModelicaScriptingTools.getSimulationSettings"><code>getSimulationSettings(omc:: OMCSession, name:: String; override=Dict())</code></a>.</p><p>The simulation output will be written to the current working directory of the OMC that has been set by <a href="#ModelicaScriptingTools.setupOMCSession"><code>setupOMCSession(outdir, modeldir; quiet=false, checkunits=true)</code></a>.</p><p>The simulation result is checked for errors with the following methods:</p><ul><li>The messages returned by the OM scripting call are checked for   the string <code>Simulation execution failed</code>. This will, e.g., be the case   if there is an arithmetic error during simulation.</li><li>The abovementioned messages are checked for the string <code>| warning |</code> which   hints at missing initial values and other non-critical errors.</li><li>The error string returned by the OM scripting function <code>getErrorString()</code>   should be empty if the simulation was successful.</li></ul><p>If any of the abovementioned methods reveals errors, a <a href="#ModelicaScriptingTools.MoSTError"><code>MoSTError</code></a> is thrown.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L202-L229">source</a></section></article><h2 id="Testing-1"><a class="docs-heading-anchor" href="#Testing-1">Testing</a><a class="docs-heading-anchor-permalink" href="#Testing-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.testmodel" href="#ModelicaScriptingTools.testmodel"><code>ModelicaScriptingTools.testmodel</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">testmodel(omc, name; override=Dict(), refdir=&quot;regRefData&quot;, regRelTol:: Real= 1e-6)</code></pre><p>Performs a full test of the model named <code>name</code> with the following steps:</p><ul><li>Load the model using <a href="#ModelicaScriptingTools.loadModel"><code>loadModel(omc:: OMCSession, name:: String)</code></a> (called inside <code>@test</code>)</li><li>Simulate the model using <a href="#ModelicaScriptingTools.simulate"><code>simulate(omc:: OMCSession, name::String, settings:: Dict{String, Any})</code></a> (called inside <code>@test</code>)</li><li>If a reference file exists in <code>refdir</code>, perform a regression test with   <a href="#ModelicaScriptingTools.regressionTest"><code>regressionTest(omc:: OMCSession, name:: String, refdir:: String; relTol:: Real = 1e-6, variableFilter:: String = &quot;&quot;, outputFormat=&quot;csv&quot;)</code></a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L331-L340">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.regressionTest" href="#ModelicaScriptingTools.regressionTest"><code>ModelicaScriptingTools.regressionTest</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">regressionTest(
    omc:: OMCSession, name:: String, refdir:: String;
    relTol:: Real = 1e-6, variableFilter:: String = &quot;&quot;, outputFormat=&quot;csv&quot;
)</code></pre><p>Performs a regression test that ensures that variable values in the simulation output are approximately equal to variables in the reference file in the directory given by <code>refdir</code>. Both the simulation output and the reference file must have the standard name <code>&quot;$(name)_res.$outputFormat&quot;</code>. This function also assumes that the simulation a simulation of the model named <code>name</code> has already been run with <a href="#ModelicaScriptingTools.simulate"><code>simulate(omc:: OMCSession, name::String, settings:: Dict{String, Any})</code></a>.</p><p>The test consists of the following checks performed with <code>@test</code>:</p><ul><li>Are there no variables in the simulation output that have no corresponding   variable in the reference file? For this check, variables are ignored that   occur in the simulation file but should not have been selected by the   regex <code>variableFilter</code>. This can happen in OpenModelica, because sometimes   alias variables are added to the output even though they do not match the   <code>variableFilter</code>.</li><li>Are there no variables in the reference file that have no corresponding   variable in the simulation output?</li><li>Is the intersection of common variables in both files nonempty?</li><li>Is the length of the simulation output equal to the length of the reference   file?</li><li>Are there any variables in the simulation file that do not satisfy   <code>isapprox(act, ref, rtol=relTol)</code> for all values?</li></ul><p>NOTE: There is a OM scripting function <code>compareSimulationResults()</code> that could be used for this task, but it is not documented and does not react to changes of its <code>relTol</code> parameter in a predictable way.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L248-L282">source</a></section></article><h2 id="Error-handling-1"><a class="docs-heading-anchor" href="#Error-handling-1">Error handling</a><a class="docs-heading-anchor-permalink" href="#Error-handling-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.MoSTError" href="#ModelicaScriptingTools.MoSTError"><code>ModelicaScriptingTools.MoSTError</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">MoSTError</code></pre><p>Error class for OMJulia-related errors that contains the OMC error message.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L14-L18">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ModelicaScriptingTools.MoSTError-Tuple{OMJulia.OMCSession,String}" href="#ModelicaScriptingTools.MoSTError-Tuple{OMJulia.OMCSession,String}"><code>ModelicaScriptingTools.MoSTError</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">MoSTError(omc:: OMCSession, msg:: String)</code></pre><p>Creates MoSTError with message <code>msg</code> and current result of <code>getErrorString()</code> as OMC error message.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/THM-MoTE/ModelicaScriptingTools.jl/blob/a1e2cd0c21a8983a1110a4ded6f0bea23cbcd23b/src/ModelicaScriptingTools.jl#L26-L31">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 30 July 2020 13:26">Thursday 30 July 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
